angular.module("z.filters",[]).filter("zClassify",[function(){return function(e){return e.join("-")}}]).filter("zName",[function(){return function(e){return e.replace(/(^\'|\_)?(\.\w+)?(\'$)?/g,"").split("/").reverse()[0]}}]).filter("zFindBy",[function(){return function(e,t,n){var r,a;for(null==n&&(n="name"),a=e.length,r=0;a>r;){if(e[r][n]===t)return e[r];r++}return null}}]).filter("zPaneFill",[function(){return function(e,t){var n,r,a;if(e){for(r=e.length,n=0;r>n;){if(a=e[n].split(":"),a[0]===t)return a[1];n++}return null}}}]),angular.module("z.animations",[]),angular.module("z.services",[]).provider("z",[function(){var e;return e={name:"default",paneRootPath:""},{config:function(t){return angular.extend(e,t),e},setStack:function(t){return angular.extend(e,t)},$get:function(){return e}}}]).factory("zPhases",[function(){var e;return e=[],function(){return{add:function(t){return e.push(t)},history:e}}}]),angular.module("z.controllers",[]),angular.module("z.directives",[]).directive("zStack",["$rootScope","$filter",function(e,t){var n,r;return n="z-stack-name",r="z-stack",{restrict:"A",controller:["z",function(t){this.stack=t,e.currentZPhase&&console.log("set current phase first",e.currentZPhase)}],link:function(e,a,l,o){var i;i=o.stack.name,a.addClass(r).attr(n,i),a.attr("id")||a.attr("id",t("zClassify")([r,i])),e.zEl=a}}}]).directive("zLayer",["$filter",function(e){var t,n;return t="z-layer-name",n="z-layer",{restrict:"A",require:"^zStack",scope:{template:"@ngInclude"},controller:angular.noop,link:function(r,a){var l;l=e("zName")(r.template),a.addClass(n).attr(t,l),a.attr("id")||a.attr("id",e("zClassify")([n,l])),r.zEl=a}}}]).directive("zPane",["$rootScope","$filter","$http","$templateCache","$controller","$compile",function(e,t,n,r,a,l){var o,i;return o="z-pane-name",i="z-pane",{restrict:"A",require:"^zLayer",scope:{template:"@ngInclude",zPaneName:"@zPane"},controller:angular.noop,link:function(e,s,c){var u;if(c.zPane&&c.zPane!==i)u=c.zPane;else{if(!e.template)return console.warn("no z-name");u=t("zName")(e.template)}s.addClass(i).attr(o,u),s.attr("id")||s.attr("id",t("zClassify")([i,u])),e.hasOwnProperty("template")||e.$on("loadPaneFill",function(t,o){n.get(o.rootPath+"/panes/_"+o.fill+".html",{cache:r}).then(function(t){var n,r;r=e,n=a(o.fill,{$scope:r}),s.html(t.data),s.children().data("$ngControllerController",n),l(s.contents())(r)})}),e.zEl=s}}}]).directive("zPhase",["z","zPhases","$filter","$document","$animate","$rootScope",function(e,t,n,r,a,l){var o,i,s,c,u,f,p,d,z;return c=new t,z=function(t){var n;return n=t?t.split("."):[],3!==n.length?console.warn("incorrectly formatted stack.layer.pane"):{stack:n[0],layer:n[1],pane:n[2],paneFills:e.paneFills}},p=function(e,t){var n,r,a;return r=c.history.length,n=r>0?c.history[r-1]:null,a=t.zPhase,t.zPhaseRevert&&n===a&&(a=t.zPhaseRevert),i(n,a)},s=function(e,t){var n,r,a,l,o,i,s,c,u,f;return r=e.el[0],a=r.offsetHeight,l=r.offsetWidth,o=r.offsetLeft,i=r.offsetTop,s=t.el[0],n=s.offsetHeight,c=s.offsetWidth,u=s.offsetLeft,f=s.offsetTop,{h:n,w:c,x1:u,y1:f,x2:u+c,y2:f+n,mY:n/2,mX:c/2,fH:a===n,fW:l===c,parentLayer:{h:a,w:l,x1:o,y1:i,mY:a/2,mX:l/2}}},u=function(e){var t,n;return n=e.y2,t=e.x2,e.x1+e.mX>e.parentLayer.mX&&(t=-(e.parentLayer.w-e.x1)),e.y1+e.mY>e.parentLayer.mY&&(n=-(e.parentLayer.h-e.y1)),e.fH&&(n=0),e.fW&&(t=0),{top:n,left:t}},f=function(e,t){var r,a,l,o,i,c,f;return l=t.stack.layers,a=n("zFindBy")(l,e.slp.layer),i=n("zFindBy")(l,t.slp.layer),c=n("zFindBy")(i.panes,t.slp.pane),f=s(i,c),o=u(f),r=i.zIndex-a.zIndex,0>r&&(l=l.reverse()),angular.forEach(l,function(e){return e.el.hasClass("omit")?void 0:e.zIndex<=i.zIndex?e.el.css("transform","translate3d(0,0,0)"):e.el.css("transform","translate3d("+o.left+"px, "+o.top+"px, 0)")}),o},i=function(e,t){var n,r;return n=d(e),r=d(t),n?e!==t?(l.$apply(function(e){return console.log("zPhase changed:",t),e.currentZPhase=t}),angular.equals(n.stack,r.stack)?f(n,r):console.log("different ballstacks"),c.add(t)):void 0:console.error("stack not registered")},o=function(e){return e.scope.$broadcast("loadPaneFill",e)},d=function(t){var a,l,i,s;return i=r[0].querySelector("[z-stack]"),i=angular.element(i),t||(t=[e.name,e.defaultLayer,e.defaultPhase].join(".")),(a=z(t))?(l={type:"stack",name:a.stack,el:i,scope:i.data("$scope"),layers:[],z:e},s=i.children("[z-layer]"),angular.forEach(s,function(e,t){var r;return e=angular.element(e),this.layers[t]={type:"layer",name:e.attr("z-layer-name"),el:e,scope:e.data("$scope"),zIndex:t,panes:[]},r=e.children("[z-pane]"),angular.forEach(r,function(e,t){var r;return e=angular.element(e),r=e.attr("z-pane-name"),this.panes[t]={type:"pane",name:r,el:e,scope:e.data("$scope"),fill:n("zPaneFill")(a.paneFills,r),rootPath:l.z.paneRootPath},this.panes[t].fill?o(this.panes[t]):void 0},this.layers[t])},l),{phase:t,slp:a,stack:l}):void 0},{restrict:"A",require:"^zPane",controller:angular.noop,scope:{zPhase:"@"},link:function(e,t,n){t.bind("click",angular.bind(t,p,e,n))}}}]),angular.module("z",["ngRoute","ngAnimate","z.animations","z.filters","z.services","z.controllers","z.directives"]);